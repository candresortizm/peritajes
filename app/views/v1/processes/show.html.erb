<h1>Vista proceso de documentación</h1>

<%= form_for @process,
    url:update_process_path, method: :patch,
    id: "process_form",
    :html => {class: 'new_process'}, multipart: true do |f|%>
  <%= f.hidden_field :dispatcher_id, value: current_user.id %>
  <%= f.hidden_field :id, value: @process.id %>
  <%= f.hidden_field :car_id, value: @process.car.id %>
  <%= f.hidden_field :state, value: 'open' %>
  <br>
  <br>
  <%= f.fields_for :car_attributes, @process.car do |car|%>
    <%= car.label(:car_type, "Tipo de carro") %>
    <%= car.select :car_type_id, options_from_collection_for_select(@car_types, "id", "name",selected: @process.car.car_type_id),{include_blank: "Seleccione"}, {required:true, disabled:!@process.car.id.nil?} %></br>
    <%= car.label(:car_brand, "Marca") %>
    <%= car.text_field :car_brand, disabled: !@process.car.id.nil?, required: true %><br>
    <%= car.label(:model, "Modelo") %>
    <%= car.text_field :model, disabled: !@process.car.id.nil?, required: true %><br>
    <%= car.label(:year, "Año") %>
    <%= car.text_field :year, disabled: !@process.car.id.nil?, required: true %><br>
    <%= car.label(:year, "VIN") %>
    <%= car.text_field :vin, disabled: !@process.car.id.nil?, required: true %><br>
    <%= car.label(:year, "Placa") %>
    <%= car.text_field :plate, disabled: !@process.car.id.nil?, required: true, class:"plate_input" %><br>
  <%end%>
  <br>
  <br>
  <%@doc_types.each do |doc_type|%>
    <%= f.fields_for :documents_attributes, @process.documents.build do |document| %>
      <h3><%= doc_type.name %></h3>
      <%= document.hidden_field :document_type_id, value: doc_type.id %>
      <%= document.label(:document, "Documento") %>
      <%if !@documents[doc_type.id].nil? %>
        <h1><%=@documents[doc_type.id].document.url%></h1>
      <%end%>
      <%= document.file_field(:document) %><br>
      <label> Comentario </label>
      <%= document.text_area :comment, rows: '6' %><br>
    <%end%>
  <%end%>
  <%= submit_tag("Finalizar") %>
<% end %>

<script type="text/javascript">
  function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
            // Remove class upload, the one that has the background image
            var $parent = $(input).closest('div.carthumb');
            $($parent).removeClass("upload");
            // Show the img tag
            $($parent).find('img').show();

            // Change the src of the img tag to the img loaded
            $($parent).find('img').attr('src', reader.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
  }

  // Everytime the [input:file] change do
  $(":file").change(function(){
      readURL(this);
  });
</script>
