<h1>Nuevo peritaje</h1>

<ul class="nav nav-tabs">
    <li class="nav-item">
      <a class="nav-link active" href="#general_info" data-toggle="tab">
        Información del peritaje
      </a>
    </li>
    <%@questions.each do |category|%>
      <li class="nav-item">
        <a class="nav-link" href="#<%=I18n.transliterate(category[0].name.downcase.gsub(" ","_"))%>" data-toggle="tab">
          <%=category[0].name%>
        </a>
      </li>
    <%end%>
    <li class="nav-item">
      <a class="nav-link" href="#photos" data-toggle="tab">
        Fotos
      </a>
    </li>
</ul>


<%= form_for @benchmark,
    url:create_benchmark_path, method: :post,
    id: "benchmark_form",
    :html => {class: 'tab-content new_benchmark'}, multipart: true do |f|%>
    <div class="tab-pane active" id="general_info">
      <%= f.hidden_field :car_expert_id, value: current_user.id %>
      <%= f.hidden_field :car_id, value: @benchmark.car.id %>
      <%= f.label(:owner, "Dueño") %>
      <%= f.text_field :owner, required: true %><br>
      <%= f.label(:kilometraje, "Kilometraje") %>
      <%= f.text_field :kilometraje, required: true %><br>
      <%= f.label(:color, "Color") %>
      <%= f.text_field :color, required: true %><br>
      <%= f.fields_for :car_attributes, @benchmark.car do |car|%>
        <%= car.label(:car_type, "Tipo de carro") %>
        <%= car.select :car_type_id, options_from_collection_for_select(@car_types, "id", "name",selected: @benchmark.car.car_type_id),{include_blank: "Seleccione"}, {required:true, disabled:!@benchmark.car.id.nil?} %></br>
        <%= car.label(:car_brand, "Marca") %>
        <%= car.text_field :car_brand, disabled: !@benchmark.car.id.nil?, required: true %><br>
        <%= car.label(:model, "Modelo") %>
        <%= car.text_field :model, disabled: !@benchmark.car.id.nil?, required: true %><br>
        <%= car.label(:year, "Año") %>
        <%= car.text_field :year, disabled: !@benchmark.car.id.nil?, required: true %><br>
        <%= car.label(:year, "VIN") %>
        <%= car.text_field :vin, disabled: !@benchmark.car.id.nil?, required: true %><br>
        <%= car.label(:year, "Placa") %>
        <%= car.text_field :plate, disabled: !@benchmark.car.id.nil?, required: true, class:"plate_input" %><br>
      <%end%>
      <a class="btn btn-primary btnNext">Next</a>
    </div>


  <%@questions.each do |question_category|%>
    <div class="tab-pane" id="<%=I18n.transliterate(question_category[0].name.downcase.gsub(" ","_"))%>">
      <h3><%=question_category[0].name%></h3>
      <%question_category[1].each_with_index do |question,index|%>
        <span><%=question.text_query%></span><br>
        <%= f.fields_for :car_answers, @benchmark.car_answers.build do |car_answer| %>
          <%= car_answer.hidden_field :question_id, value: question.id %>
          <div class="radio_button">
          <%case question.question_type%>
          <%when "range"%>
            <label class="red">
              <%= car_answer.radio_button(:answer, "1", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Mal</span>
            </label>
            <label class="yellow">
              <%= car_answer.radio_button(:answer, "2", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Aceptable</span>
            </label>
            <label class="green">
              <%= car_answer.radio_button(:answer, "3", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Bien</span>
            </label>
          <%when "yes_or_no"%>
            <label class="green">
              <%= car_answer.radio_button(:answer, "3", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Si</span>
            </label>
            <label class="red">
              <%= car_answer.radio_button(:answer, "1", {required: true, data:{'question-type':question.question_type}}) %>
              <span>No</span>
            </label>
          <%when "yes_no_na"%>
            <label class="green">
              <%= car_answer.radio_button(:answer, "3", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Si</span>
            </label>
            <label class="red">
              <%= car_answer.radio_button(:answer, "1", {required: true, data:{'question-type':question.question_type}}) %>
              <span>No</span>
            </label>
            <label class="yellow">
              <%= car_answer.radio_button(:answer, "0", {required: true, data:{'question-type':question.question_type}}) %>
              <span>No Aplica</span>
            </label>
          <%when "good_bad"%>
            <label class="green">
              <%= car_answer.radio_button(:answer, "3", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Bien</span>
            </label>
            <label class="red">
              <%= car_answer.radio_button(:answer, "1", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Mal</span>
            </label>
          <%when "good_bad_na"%>
            <label class="green">
              <%= car_answer.radio_button(:answer, "3", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Bien</span>
            </label>
            <label class="red">
              <%= car_answer.radio_button(:answer, "1", {required: true, data:{'question-type':question.question_type}}) %>
              <span>Mal</span>
            </label>
            <label class="yellow">
              <%= car_answer.radio_button(:answer, "0", {required: true, data:{'question-type':question.question_type}}) %>
              <span>No Aplica</span>
            </label>
          <%when "text"%>
            <%= car_answer.text_field :answer, required: true %><br>
          <%else%>
            <label><%=question.question_type%></label>
          <%end%>
          </div>
          <%= f.fields_for :inspection_photos, @benchmark.inspection_photos.build do |inspection_photo| %>
            <div class="upload carthumb photoshoot__upload">
              <%= inspection_photo.hidden_field :question_id, value: question.id %>
              <%= inspection_photo.file_field(:image, accept: 'image/png,image/gif,image/jpeg') %>
              <img class="img-thumbnail center-block" alt="your image" target="_blank" src="#" style="display: none;">
            </div>
          <%end%>
          <br>
        <%end%>
      <%end%>
      <br><br>
      <%= f.fields_for :inspection_comments, @benchmark.inspection_comments.build do |inspection_comment| %>
        <label> Comentarios para <%= question_category[0].name %> </label>
        <%= inspection_comment.hidden_field :question_category_id, value: question_category[0].id %>
        <%= inspection_comment.text_area :comment, rows: '6' %>
      <%end%>
      <a class="btn btn-primary btnNext">Next</a>
      <a class="btn btn-primary btnPrevious">Previous</a>
    </div>
  <%end%>
  <div class="tab-pane" id="photos">
    <div class="upload carthumb photoshoot__upload">
      <label> Foto frontal </label>
      <%= f.file_field(:photo_front, accept: 'image/png,image/gif,image/jpeg') %>
      <img class="img-thumbnail center-block" alt="your image" target="_blank" src="#" style="display: none;">
    </div>
    <div class="upload carthumb photoshoot__upload">
      <label> Foto lado derecho </label>
      <%= f.file_field(:photo_right, accept: 'image/png,image/gif,image/jpeg') %>
      <img class="img-thumbnail center-block" alt="your image" target="_blank" src="#" style="display: none;">
    </div>
    <div class="upload carthumb photoshoot__upload">
      <label> Foto atras </label>
      <%= f.file_field(:photo_back, accept: 'image/png,image/gif,image/jpeg') %>
      <img class="img-thumbnail center-block" alt="your image" target="_blank" src="#" style="display: none;">
    </div>
    <div class="upload carthumb photoshoot__upload">
      <label> Foto lado izquierdo </label>
      <%= f.file_field(:photo_left, accept: 'image/png,image/gif,image/jpeg') %>
      <img class="img-thumbnail center-block" alt="your image" target="_blank" src="#" style="display: none;">
    </div>
    <div class="upload carthumb photoshoot__upload">
      <label> Foto motor </label>
      <%= f.file_field(:photo_motor, accept: 'image/png,image/gif,image/jpeg') %>
      <img class="img-thumbnail center-block" alt="your image" target="_blank" src="#" style="display: none;">
    </div>
    <div class="upload carthumb photoshoot__upload">
      <label> Foto interior </label>
      <%= f.file_field(:photo_inside, accept: 'image/png,image/gif,image/jpeg') %>
      <img class="img-thumbnail center-block" alt="your image" target="_blank" src="#" style="display: none;">
    </div>
    <a class="btn btn-primary btnPrevious">Previous</a>
  </div>
  <%= submit_tag("Finalizar") %>
<% end %>

<script type="text/javascript">
  function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
            // Remove class upload, the one that has the background image
            var $parent = $(input).closest('div.carthumb');
            $($parent).removeClass("upload");
            // Show the img tag
            $($parent).find('img').show();

            // Change the src of the img tag to the img loaded
            $($parent).find('img').attr('src', reader.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
  }

  $('.btnNext').click(function(){
    $('.nav-tabs a.active').parent().next('li').find('a').trigger('click');
  });

  $('.btnPrevious').click(function(){
    $('.nav-tabs a.active').parent().prev('li').find('a').trigger('click');
  });

  // Everytime the [input:file] change do
  $(":file").change(function(){
      readURL(this);
  });
</script>
